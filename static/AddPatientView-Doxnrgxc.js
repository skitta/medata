import{d as x,a as b,r as $,q as F,R as O,A as V,w as r,e as a,o as U,g as T,c as t,h as p,S as Y,f as E,U as G,B as H,V as L}from"./index-BiGCB4QH.js";import{c as z,d as J,e as K,f as Q}from"./kawasaki-DZtnSqoT.js";import{u as W,M as X}from"./useErrorHandler-QsF4PFYd.js";import{C as Z}from"./index-qypLa9ml.js";import{I as w,S as C,a as M}from"./index-ETVDh3mm.js";import{A as I,D as ee}from"./index-Cb26gAr0.js";import{A as h,R as y}from"./index-Ckd5ry5m.js";import{B as ae}from"./index-Cci2ZnYS.js";import{A as n,F as te}from"./index-DzM_ZPjP.js";import{A as le}from"./index-B7_ea9DU.js";import"./index-DIUhM0Ao.js";import"./Dropdown-BEWj0Aq1.js";import"./Col-b7LGXneF.js";import"./hasIn-Chqo4bGS.js";import"./useMergedState-DAsMUKIf.js";import"./PlusOutlined-B_beIY8w.js";function re(){return{createRequiredRule:s=>({required:!0,message:s,trigger:"blur"}),createNumberRule:(s,i=0)=>({required:!0,validator:async(d,f)=>f==null?Promise.reject(`请输入${s}`):Number.isInteger(f)?f<i?Promise.reject(`${s}不能小于${i}`):Promise.resolve():Promise.reject(`${s}必须为整数`),trigger:"blur"}),createPositiveNumberRule:s=>({required:!0,validator:async(i,d)=>d==null?Promise.reject(`请输入${s}`):d<0?Promise.reject(`${s}不能小于0`):Promise.resolve(),trigger:"blur"}),createAsyncValidationRule:(s,i)=>({required:!0,validator:async(d,f)=>!f||!await s(f)?Promise.reject(i):Promise.resolve(),trigger:"blur"})}}const ke=x({__name:"AddPatientView",setup(j){const P=b(),{errorMessage:k,clearError:_,handleError:s}=W(),{createRequiredRule:i,createNumberRule:d,createAsyncValidationRule:f}=re(),l=$({registered_ID:"",document_ID:"",full_name:"",gender:"",age:0,in_date:"",height:0,weight:0,resistance:!1,relapse:!1}),D=b([]);F(async()=>{D.value=await z()});const m=b(!1),c=b(""),v=b(!1);let g=null;const q={registered_ID:[f(async o=>{const e=await J({search:o});return e.count>0?(g=e.results[0],c.value="登记号已存在，是否直接加载？",m.value=!0,!1):(g=null,c.value="",m.value=!1,_(),!0)},"登记号已存在")],full_name:[i("请输入姓名")],gender:[i("请选择性别")],age:[d("年龄")],in_date:[i("请选择日期")],height:[d("身高",0)],weight:[d("体重",0)],group:[i("请选择分组")]},N={labelCol:{span:4},wrapperCol:{span:18}},B=()=>{P.value?.validate().then(()=>{c.value="确认后部分字段将无法更改，是否确认？",m.value=!0}).catch(o=>{console.log(o)})},R=O(),A=H(),S=()=>{v.value=!0,_(),g&&Object.keys(g).length>0?K(g.id).then(o=>{R.setTests(o),R.setPatient(g),v.value=!1,m.value=!1,A.push({name:"add-tests"})}).catch(o=>{v.value=!1,m.value=!1,s(o)}):Q(L(l)).then(o=>{R.setPatient(o),R.setTests({}),v.value=!1,m.value=!1,A.push({name:"add-tests"})}).catch(o=>{v.value=!1,m.value=!1,s(o)})};return(o,e)=>(U(),V(a(Z),{title:"添加新患者"},{default:r(()=>[a(k)?(U(),V(a(le),{key:0,message:a(k),type:"error","show-icon":"",closable:"",onClose:a(_),style:{"margin-bottom":"16px"}},null,8,["message","onClose"])):T("",!0),t(a(te),Y({name:"Patient",ref_key:"formRef",ref:P,model:l,rules:q},N),{default:r(()=>[t(a(n),{"has-feedback":"",label:"登记号",name:"registered_ID"},{default:r(()=>[t(a(w),{value:l.registered_ID,"onUpdate:value":e[0]||(e[0]=u=>l.registered_ID=u)},null,8,["value"])]),_:1}),t(a(n),{label:"住院号",name:"document_ID"},{default:r(()=>[t(a(w),{value:l.document_ID,"onUpdate:value":e[1]||(e[1]=u=>l.document_ID=u)},null,8,["value"])]),_:1}),t(a(n),{"has-feedback":"",label:"姓名",name:"full_name"},{default:r(()=>[t(a(w),{value:l.full_name,"onUpdate:value":e[2]||(e[2]=u=>l.full_name=u)},null,8,["value"])]),_:1}),t(a(n),{"has-feedback":"",label:"性别",name:"gender"},{default:r(()=>[t(a(C),{value:l.gender,"onUpdate:value":e[3]||(e[3]=u=>l.gender=u)},{default:r(()=>[t(a(M),{value:"M"},{default:r(()=>e[12]||(e[12]=[p("男")])),_:1,__:[12]}),t(a(M),{value:"F"},{default:r(()=>e[13]||(e[13]=[p("女")])),_:1,__:[13]})]),_:1},8,["value"])]),_:1}),t(a(n),{"has-feedback":"",label:"年龄(月)",name:"age"},{default:r(()=>[t(a(I),{value:l.age,"onUpdate:value":e[4]||(e[4]=u=>l.age=u),style:{width:"100%"}},null,8,["value"])]),_:1}),t(a(n),{"has-feedback":"",label:"入院日期",name:"in_date"},{default:r(()=>[t(a(ee),{value:l.in_date,"onUpdate:value":e[5]||(e[5]=u=>l.in_date=u),"value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["value"])]),_:1}),t(a(n),{"has-feedback":"",label:"身高(cm)",name:"height"},{default:r(()=>[t(a(I),{value:l.height,"onUpdate:value":e[6]||(e[6]=u=>l.height=u),style:{width:"100%"}},null,8,["value"])]),_:1}),t(a(n),{"has-feedback":"",label:"体重(kg)",name:"weight"},{default:r(()=>[t(a(I),{value:l.weight,"onUpdate:value":e[7]||(e[7]=u=>l.weight=u),style:{width:"100%"}},null,8,["value"])]),_:1}),t(a(n),{"has-feedback":"",label:"分组",name:"group"},{default:r(()=>[t(a(C),{value:l.group,"onUpdate:value":e[8]||(e[8]=u=>l.group=u),options:D.value},null,8,["value","options"])]),_:1}),t(a(n),{label:"IVIG 抵抗",name:"resistance"},{default:r(()=>[t(a(h),{value:l.resistance,"onUpdate:value":e[9]||(e[9]=u=>l.resistance=u)},{default:r(()=>[t(a(y),{value:!0},{default:r(()=>e[14]||(e[14]=[p("是")])),_:1,__:[14]}),t(a(y),{value:!1},{default:r(()=>e[15]||(e[15]=[p("否")])),_:1,__:[15]})]),_:1},8,["value"])]),_:1}),t(a(n),{label:"复发病历",name:"relapse"},{default:r(()=>[t(a(h),{value:l.relapse,"onUpdate:value":e[10]||(e[10]=u=>l.relapse=u)},{default:r(()=>[t(a(y),{value:!0},{default:r(()=>e[16]||(e[16]=[p("是")])),_:1,__:[16]}),t(a(y),{value:!1},{default:r(()=>e[17]||(e[17]=[p("否")])),_:1,__:[17]})]),_:1},8,["value"])]),_:1}),t(a(n),{"wrapper-col":{span:14,offset:4}},{default:r(()=>[t(a(ae),{type:"primary",onClick:B},{default:r(()=>e[18]||(e[18]=[p("确认")])),_:1,__:[18]})]),_:1})]),_:1},16,["model"]),t(a(X),{open:m.value,"onUpdate:open":e[11]||(e[11]=u=>m.value=u),title:"确认信息",onOk:S,"confirm-loading":v.value},{default:r(()=>[E("p",null,G(c.value),1)]),_:1},8,["open","confirm-loading"])]),_:1}))}});export{ke as default};
