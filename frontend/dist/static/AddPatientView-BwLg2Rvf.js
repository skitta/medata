/* empty css                */import{C}from"./index-DepGDQd6.js";import"./index-Bs59S7SY.js";import{M as R}from"./index-Bgd_YiLT.js";import{_ as V}from"./index-BdYYenth.js";import{F as y,_ as N}from"./index-C5EvdOSD.js";import{B as q}from"./index-CKpO3Wyb.js";import{R as D,_ as F}from"./index-CqDKeIc1.js";import{_ as h,D as $}from"./index-Co12GfzI.js";import{S as c,I as B,a as G}from"./index-CSg5cDbo.js";import{_ as T,d as Y,z as O,w as s,b as v,r as E,s as L,u as z,e as H,N as W,o as j,g as J,c as r,h as p,f as K,O as Q}from"./index-DFZFHgnd.js";import{c as X,d as Z,e as x,f as ee}from"./kawasaki-CjYxmOO9.js";import"./index-DB7tIDCQ.js";import"./js.cookie-Bd2-tppU.js";import"./useState-Rb6RYO6z.js";import"./_flatRest-CcNSYLso.js";import"./PlusOutlined-CUymhBc9.js";import"./index-Bk2m-043.js";import"./createForOfIteratorHelper-SBXSWyxR.js";const{Item:te}=y,{Option:ae}=c,{Group:re}=D,oe=Y({name:"AddPatientView",components:{ACard:C,AForm:y,AFormItem:te,AInput:B,ASelect:c,ASelectOption:ae,ADatePicker:$,AInputNumber:h,AButton:q,AModal:R,ARadioGroup:re,ARadio:D,AAlert:V},setup(){const a=v(),e=v(""),A=E({registered_ID:"",document_ID:"",full_name:"",gender:"",age:void 0,in_date:void 0,height:void 0,weight:void 0,group:"",resistance:!1,relapse:!1}),k=v([]);L(async()=>{k.value=await X()});const n=v(!1),_=v(""),i=v(!1),m=()=>{e.value=""},l=o=>{if(console.error(o),o.response&&o.response.status===409)e.value="数据冲突：其他用户可能已修改此数据，请刷新页面重试";else if(o.response&&o.response.data&&o.response.data.detail)e.value=o.response.data.detail;else if(o.response&&o.response.data){const t=o.response.data,d=[];for(const b in t)Array.isArray(t[b])?d.push(`${b}: ${t[b].join(", ")}`):d.push(`${b}: ${t[b]}`);e.value=d.join("; ")}else e.value=o.message||"操作失败，请重试"};let P=async(o,t)=>t?Number.isInteger(t)?t<0?Promise.reject("年龄不能小于0"):Promise.resolve():Promise.reject("年龄必须为整数"):Promise.reject("请输入年龄"),S=async(o,t)=>t?t<0?Promise.reject("不能小于0"):Promise.resolve():Promise.reject("请输入数字"),u={};const f={registered_ID:[{required:!0,validator:async(o,t)=>{if(!t)return Promise.reject("请输入登记号");try{const d=await Z({search:t});return d.count>0?(u=d.results[0],_.value="登记号已存在，是否直接加载？",n.value=!0,Promise.reject("登记号已存在")):(u={},_.value="",n.value=!1,m(),Promise.resolve())}catch(d){return l(d),Promise.reject("检索登记号失败")}},trigger:"blur"}],full_name:[{required:!0,message:"请输入姓名",trigger:"blur"}],gender:[{required:!0,message:"请选择性别",trigger:"blur"}],age:[{required:!0,validator:P,trigger:"blur"}],in_date:[{required:!0,message:"请选择日期",trigger:"blur"}],height:[{required:!0,validator:S,trigger:"blur"}],weight:[{required:!0,validator:S,trigger:"blur"}],group:[{required:!0,message:"请选择分组",trigger:"blur"}],status:[{required:!0,message:"请选择状态",trigger:"blur"}]},w=()=>{a.value.validate().then(()=>{_.value="确认后部分字段将无法更改，是否确认？",n.value=!0}).catch(o=>{console.log(o)})},g=z(),I=H();return{formRef:a,formState:A,groupOptions:k,modalVisible:n,modalMsg:_,confireLoading:i,errorMessage:e,rules:f,showModal:w,handleOk:()=>{i.value=!0,m(),Object.keys(u).length>0?x(u.id).then(o=>{g.dispatch("setTests",o),g.dispatch("setPatient",u),i.value=!1,n.value=!1,I.push({name:"add-tests"})}).catch(o=>{i.value=!1,n.value=!1,l(o)}):ee(W(A)).then(o=>{g.dispatch("setPatient",o),g.dispatch("setTests",{}),i.value=!1,n.value=!1,I.push({name:"add-tests"})}).catch(o=>{i.value=!1,n.value=!1,l(o)})},clearError:m}}});function se(a,e,A,k,n,_){const i=V,m=B,l=N,P=G,S=c,u=h,M=$,f=D,w=F,g=q,I=y,U=R,o=C;return j(),O(o,{title:"添加新患者"},{default:s(()=>[a.errorMessage?(j(),O(i,{key:0,message:a.errorMessage,type:"error","show-icon":"",closable:"",onClose:a.clearError,style:{"margin-bottom":"16px"}},null,8,["message","onClose"])):J("",!0),r(I,{name:"Patient",ref:"formRef",model:a.formState,rules:a.rules,"label-col":{span:4},"wrapper-col":{span:18}},{default:s(()=>[r(l,{label:"登记号",name:"registered_ID"},{default:s(()=>[r(m,{value:a.formState.registered_ID,"onUpdate:value":e[0]||(e[0]=t=>a.formState.registered_ID=t)},null,8,["value"])]),_:1}),r(l,{label:"住院号",name:"document_ID"},{default:s(()=>[r(m,{value:a.formState.document_ID,"onUpdate:value":e[1]||(e[1]=t=>a.formState.document_ID=t)},null,8,["value"])]),_:1}),r(l,{label:"姓名",name:"full_name"},{default:s(()=>[r(m,{value:a.formState.full_name,"onUpdate:value":e[2]||(e[2]=t=>a.formState.full_name=t)},null,8,["value"])]),_:1}),r(l,{label:"性别",name:"gender"},{default:s(()=>[r(S,{value:a.formState.gender,"onUpdate:value":e[3]||(e[3]=t=>a.formState.gender=t)},{default:s(()=>[r(P,{value:"M"},{default:s(()=>e[15]||(e[15]=[p("男")])),_:1,__:[15]}),r(P,{value:"F"},{default:s(()=>e[16]||(e[16]=[p("女")])),_:1,__:[16]})]),_:1},8,["value"])]),_:1}),r(l,{label:"年龄(月)",name:"age"},{default:s(()=>[r(u,{value:a.formState.age,"onUpdate:value":e[4]||(e[4]=t=>a.formState.age=t),style:{width:"100%"}},null,8,["value"])]),_:1}),r(l,{label:"入院日期",name:"in_date"},{default:s(()=>[r(M,{value:a.formState.in_date,"onUpdate:value":e[5]||(e[5]=t=>a.formState.in_date=t),"value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["value"])]),_:1}),r(l,{label:"身高(cm)",name:"height"},{default:s(()=>[r(u,{value:a.formState.height,"onUpdate:value":e[6]||(e[6]=t=>a.formState.height=t),style:{width:"100%"}},null,8,["value"])]),_:1}),r(l,{label:"体重(kg)",name:"weight"},{default:s(()=>[r(u,{value:a.formState.weight,"onUpdate:value":e[7]||(e[7]=t=>a.formState.weight=t),style:{width:"100%"}},null,8,["value"])]),_:1}),r(l,{label:"分组",value:a.formState.group,"onUpdate:value":e[9]||(e[9]=t=>a.formState.group=t),name:"group"},{default:s(()=>[r(S,{value:a.formState.group,"onUpdate:value":e[8]||(e[8]=t=>a.formState.group=t),options:a.groupOptions},null,8,["value","options"])]),_:1},8,["value"]),r(l,{label:"IVIG 抵抗",value:a.formState.resistance,"onUpdate:value":e[11]||(e[11]=t=>a.formState.resistance=t),name:"resistance"},{default:s(()=>[r(w,{value:a.formState.resistance,"onUpdate:value":e[10]||(e[10]=t=>a.formState.resistance=t)},{default:s(()=>[r(f,{value:!0},{default:s(()=>e[17]||(e[17]=[p("是")])),_:1,__:[17]}),r(f,{value:!1},{default:s(()=>e[18]||(e[18]=[p("否")])),_:1,__:[18]})]),_:1},8,["value"])]),_:1},8,["value"]),r(l,{label:"复发病历",value:a.formState.relapse,"onUpdate:value":e[13]||(e[13]=t=>a.formState.relapse=t),name:"relapse"},{default:s(()=>[r(w,{value:a.formState.relapse,"onUpdate:value":e[12]||(e[12]=t=>a.formState.relapse=t)},{default:s(()=>[r(f,{value:!0},{default:s(()=>e[19]||(e[19]=[p("是")])),_:1,__:[19]}),r(f,{value:!1},{default:s(()=>e[20]||(e[20]=[p("否")])),_:1,__:[20]})]),_:1},8,["value"])]),_:1},8,["value"]),r(l,{"wrapper-col":{span:14,offset:4}},{default:s(()=>[r(g,{type:"primary",onClick:a.showModal},{default:s(()=>e[21]||(e[21]=[p("确认")])),_:1,__:[21]},8,["onClick"])]),_:1})]),_:1},8,["model","rules"]),r(U,{visible:a.modalVisible,"onUpdate:visible":e[14]||(e[14]=t=>a.modalVisible=t),title:"确认信息",onOk:a.handleOk,"confirm-loading":a.confireLoading},{default:s(()=>[K("p",null,Q(a.modalMsg),1)]),_:1},8,["visible","onOk","confirm-loading"])]),_:1})}const De=T(oe,[["render",se]]);export{De as default};
